# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
<br>
<br>

## Описание данных и типов
### 1.Карточка товара
```
export interface ILotItem {
    id: string;
    title: string;
    description?: string;
    image: string;
    category?: string;
    price: number | null;
}
```
<br>

### 2.Состояние приложения
```
export interface IAppState {
    catalog: ILotItem[];
    basket: string[];
    preview: string | null;
    order: IOrder | null;
    loading: boolean;
}
```
<br>

### 3.Форма заказа
```
export interface IOrderForm {
    email: string;
    phone: string;
    address: string;
    payment: string;
}
```
<br>

### 4.Заказ
```
export interface IOrder extends IOrderForm {
    items: string[];
    total: number;
}
```
<br>

### 5.Ошибки формы
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```
<br>

### 6.Ставка
```
export interface IBid {
    price: number;
}
```
<br>

### 7.Результат заказа
```
export interface IOrderResult {
    id: string;
}
```

<br>
<br>

## Архитектура приложения
Слои архитектуры образуют шаблон проектирования Model-View-Presenter, сокращённо MVP:
- слой представлений, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и Изменение данных,
- презентер, отвечает за связь представления и данных.


### Базовый код 
#### Класс Api 
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый
‘адрес сервера и опциональный объект с заголовками запросов. Методы:

- `get` - выполняет СЕТ запрос на переданный в параметрах ендпоинт и возвращает
промис с объектом, которым ответил сервер

- `post` - принимает объект с данными, которые будут переданы в JSON в теле
запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове
метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть
переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события,
происходящие в системе. Класс используется в презентере для обработки событий ив
слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события, 
- `trigger` - возвращает функции, при вызове которой инициализируется требуемое в параметрах событие.

<br>

### Слой данных 

#### Класс `AppState` 
`AppState` отвечает за управление состоянием приложения, включая данные о товарах, корзине покупок, форме заказа и ошибках ввода.

Поля класса
- `basket: LotItem[]` - Массив товаров в корзине.
- `catalog: LotItem[]` - Массив товаров в каталоге.
- `loading: boolean` - Флаг загрузки данных.
- `order: IOrder` - Информация о заказе пользователя, включая email, телефон, адрес, способ оплаты и список товаров.
- `formErrors: FormErrors` - Объект с ошибками ввода данных в форме заказа.
- `_priceBasket: number` - Суммарная стоимость товаров в корзине.

\
Методы класса 
- `isBasketLot(id: string): boolean` - Проверяет, есть ли товар с указанным ID в корзине.
- `pushOrderItems(id: string)` - Добавляет ID товара в список заказанных товаров.
- `deleteOrderItem(id: string)` - Удаляет товар с указанным ID из списка заказанных товаров.
- `pushBasket(item: LotItem)` - Добавляет товар в корзину.
- `getTotal(): number` - Вычисляет суммарную стоимость товаров в корзине.
- `clearBasket()` - Очищает корзину, удаляя все товары из неё и из списка заказанных товаров.
- `setCatalog(items: ILot[])` - Устанавливает новый список товаров каталога, преобразуя его в массив объектов типа LotItem.
- `setOrderField(field: keyof IOrderForm, value: string)` - Устанавливает значение указанного поля формы заказа и проверяет валидность данных. Если данные введены корректно, генерирует событие order:ready.
- `validateContacts()` - Проверяет введенные данные в форме заказа на валидность. Если обнаружены ошибки, генерирует событие formErrors:change и возвращает false, иначе возвращает true.

AppState обеспечивает управление данными приложения и взаимодействие с другими компонентами через события и методы.

<br>

### Слой представления 
Все классы представления отвечают за отображение внутри контейнера(DOM-элемент) передаваемых в низ данных. 


#### Класс `Card` 
`Card` представляет карточку товара.

Поля
- `_title: HTMLElement`: Элемент заголовка карточки.
- `_image: HTMLImageElement | undefined`: Элемент изображения карточки.
- `_description: HTMLElement | undefined`: Элемент описания карточки.
- `_button: HTMLButtonElement | undefined`: Элемент кнопки карточки.
- `_price: HTMLElement`: Элемент цены карточки.
- `_category: HTMLElement | undefined`: Элемент категории карточки.

Конструктор
- `constructor(blockName: string, container: HTMLElement, actions?: ICardActions)`: Принимает имя блока, контейнер карточки и опциональные действия. Инициализирует карточку, настраивает элементы и добавляет слушатель событий, если необходимо.

Методы
- `set id(value: string)`: Устанавливает идентификатор карточки.
- `get id(): string`: Возвращает идентификатор карточки.
- `set price(value: number | null)`: Устанавливает цену карточки.
- `get price(): number | string`: Возвращает цену карточки.
- `set title(value: string)`: Устанавливает заголовок карточки.
- `get title(): string`: Возвращает заголовок карточки.
- `set image(value: string)`: Устанавливает изображение карточки.
- `set description(value: string | string[])`: Устанавливает описание карточки.
- `set button(value: HTMLButtonElement)`: Устанавливает кнопку карточки.
- `setImage(image: HTMLImageElement, src: string, alt: string)`: Устанавливает изображение карточки с альтернативным текстом.
- `setText(element: HTMLElement, text: string)`: Устанавливает текст элемента.
- `setPriceText(price: HTMLElement, value: number | null)`: Устанавливает текст цены карточки.
- `toggleButtonState(button: HTMLButtonElement, isEnabled: boolean)`: Устанавливает состояние кнопки.

<br>

#### Класс CatalogItem
Наследуется от `Card`. \
`CatalogItem` представляет карточку товара в каталоге.

Конструктор
- `constructor(container: HTMLElement, actions?: ICardActions)`: Принимает контейнер карточки и опциональные действия. Инициализирует карточку, используя стандартное имя блока "card".

<br>

#### Класс BasketItem
Наследуется от `Card`. \
`BasketItem` представляет карточку товара в корзине.

Конструктор
- `constructor(container: HTMLElement, actions?: ICardActions)`: Принимает контейнер карточки и опциональные действия. Инициализирует карточку, используя стандартное имя блока "card".

<br>


### Класс PreviewItem
Наследуется от `Card`. \
`PreviewItem` представляет карточку товара в превью.

Конструктор
- `constructor(container: HTMLElement, actions?: ICardActions)`: Принимает контейнер карточки и опциональные действия. Инициализирует карточку, используя стандартное имя блока "card".

Методы
- `delBasket()`: Устанавливает текст кнопки для удаления из корзины.
- `addBasket()`: Устанавливает текст кнопки для добавления в корзину.

<br>


#### Класс `Page` 
`Page` отвечает за управление отображением основной страницы приложения.

Поля класса
- `_counter: HTMLElement` - Элемент счетчика товаров в корзине.
- `_catalog: HTMLElement` - Элемент для отображения каталога товаров.
- `_wrapper: HTMLElement` - Обертка страницы.
- `_basket: HTMLElement` - Элемент корзины.

\
Методы класса
- `constructor(container: HTMLElement, events: IEvents)` - Конструктор класса. Принимает контейнер страницы и объект событий для взаимодействия с другими компонентами. Инициализирует поля класса и устанавливает слушатель события клика на элементе корзины для открытия корзины.
- `set counter(value: number)` - Устанавливает значение счетчика товаров в корзине.
- `set catalog(items: HTMLElement[])` - Устанавливает содержимое каталога товаров.
- `set locked(value: boolean)` - Устанавливает состояние блокировки страницы. Если значение true, добавляет класс page__wrapper_locked к обертке страницы, иначе удаляет этот класс.

Page обеспечивает отображение основной страницы приложения, управляя содержимым страницы и взаимодействуя с другими компонентами через события и методы.

<br>

#### Класс `Form` 
`Form` представляет общую форму для ввода данных.

Поля
- `_submit: HTMLButtonElement` - Элемент кнопки отправки формы.
- `_errors: HTMLElement` - Элемент для отображения ошибок формы.


Конструктор
- `constructor(container: HTMLFormElement, events: IEvents)` - Принимает контейнер формы и экземпляр брокера событий. Инициализирует форму, добавляет слушатель событий ввода данных для обработки изменений в полях формы.


Методы
- `onInputChange(field: keyof T, value: string)` - Обрабатывает событие изменения значения в поле формы и инициирует соответствующее событие.
- `render(state: Partial<T> & IFormState)` - Рендерит состояние формы, включая валидность, ошибки и значения полей.

<br>


#### Класс `Contacts` 
Наследуется от `Form`. \
`Contacts` представляет форму для ввода контактной информации.

Конструктор
- `constructor(container: HTMLFormElement, events: IEvents)` - Принимает контейнер формы и экземпляр брокера событий. Инициализирует форму, добавляет слушатель на событие отправки формы для предотвращения ее дефолтного поведения, инициирует событие при отправке формы.

Свойства
- `validSubmitBtn: HTMLButtonElement` - Получает кнопку для отправки формы.

Методы
- `phone(value: string)` - Устанавливает значение поля "телефон" формы.
- `email(value: string)` - Устанавливает значение поля "email" формы.
- `errors(value: string)` - Устанавливает текст ошибки для отображения пользователю.

<br>

#### Класс `Order` 
Наследуется от `Form`. \
`Order` представляет форму для оформления заказа.

Поля
- `_cash: HTMLButtonElement` - Элемент кнопки для оплаты наличными.
- `_card: HTMLButtonElement` - Элемент кнопки для оплаты картой.
- `activeButton: HTMLButtonElement | nul` - Активная кнопка оплаты.
- `_next: HTMLButtonElement` - Элемент кнопки "Далее".

\
Конструктор
- `constructor(container: HTMLFormElement, events: IEvents)` - Принимает контейнер формы и экземпляр брокера событий. Инициализирует форму, добавляет слушатели на события клика по кнопкам оплаты и кнопке "Далее".

Свойства
- `errors(value: string)` - Устанавливает текст ошибки для отображения пользователю.
- `validNextBtn(value: boolean)` - Устанавливает доступность кнопки "Далее".

\
Методы
- `cash(value: string)` - Устанавливает значение поля "оплата наличными".
- `card(value: string)` - Устанавливает значение поля "оплата картой".
- `address(value: string)` - Устанавливает значение поля "адрес доставки".

<br>

#### Класс `Success` 
`Success` отвечает за отображение сообщения об успешном завершении заказа.

Поля класса
- `_close: HTMLElement` - Элемент кнопки закрытия сообщения об успешном заказе.
- `successDescription: HTMLElement` - Элемент для отображения описания успешного заказа.

\
Методы класса
- `constructor(container: HTMLElement, actions: ISuccessActions)` - Конструктор класса. Принимает контейнер для отображения сообщения и объект действий. Инициализирует поля класса и устанавливает слушатель события клика на кнопке закрытия сообщения.
- `setTotal(value: string)` - Устанавливает текстовое описание успешного заказа.

Success предоставляет интерфейс для отображения сообщения об успешном завершении заказа и управления его содержимым.

<br>


#### Класс `Basket` 
`Basket` отвечает за отображение содержимого корзины на веб-странице. В конструкторе класса принимается контейнер, в котором будет отображаться корзина, экземпляр `EventEmitter` для инициации событий при взаимодействии с корзиной, а также дополнительные действия, переданные в виде объекта `IBasketActions`.

Поля класса
- `_list: HTMLElement` - HTML-элемент списка товаров в корзине.
- `_total: HTMLElement` -  HTML-элемент, отображающий общую стоимость товаров в корзине.
- `_button: HTMLElement` - HTML-элемент кнопки оформления заказа.
- `_delete: HTMLElement` - HTML-элемент кнопки удаления товара из корзины.

Методы класса 

 - `constructor(container: HTMLElement, events: EventEmitter, actions?: IBasketActions)` - Конструктор класса. Принимает контейнер, в котором будет отображаться корзина, экземпляр `EventEmitter` для инициации событий, а также дополнительные действия, переданные в виде объекта IBasketActions.
- `get list(): HTMLElement` - Геттер для получения HTML-элемента списка товаров в корзине.
- `get button(): HTMLElement` - Геттер для получения HTML-элемента кнопки оформления заказа.
- `set item(item: HTMLElement): void` - Сеттер для добавления отдельного товара в корзину. Если переданный товар существует, он добавляется в список товаров корзины. Если товар отсутствует, в списке отображается сообщение о том, что корзина пуста.
- `set items(items: HTMLElement[]): void` - Сеттер для замены списка товаров в корзине новым списком. Если переданный массив товаров не пуст, он заменяет текущий список товаров в корзине. Если массив пуст, в списке отображается сообщение о том, что корзина пуста.
- `set total(total: number): void` - Сеттер для отображения общей стоимости товаров в корзине. Обновляет текст в HTML-элементе, отображающем общую стоимость.

Класс Basket обеспечивает удобное отображение содержимого корзины на веб-странице и обрабатывает действия пользователя, такие как добавление и удаление товаров из корзины.

#### Класс `Modal` 
Реализует модальное окно. Представляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

Поля
- `_closeButton: HTMLButtonElement`: Элемент кнопки закрытия модального окна.
- `_content: HTMLElement`: Элемент содержимого модального окна.

Конструктор
- constructor(selector: string, events: IEvents) - Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Методы
- `set content(value: HTMLElement)`: Устанавливает содержимое модального окна.
- `open()`: Открывает модальное окно.
- `close()`: Закрывает модальное окно.
- `render(data: IModalData): HTMLElement`: Рендерит модальное окно с переданными данными.

<br>

### Слой коммуникации 

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бекэндом сервиса.

## Взаимодействие компонентов 
Код, описывающий представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера. \
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`. \
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*
- `items:changed` - вывод карточек на страницу
- `contacts:submit` - отправка формы с заказом
- `basket:delete` - Удалить один лот из корзины
- `formErrors:change` - Изменилось состояние валидации формы
- `payment` - Выбор способа оплаты
- `order:change` - Изменилось одно из полей в форме с почтой и телефоном
- `contacts:change` - Изменилось одно из полей в форме с выбором оплаты и адресом
- `order:open` - Открыть форму с почтой и телефоном
- `contacts:open` - Открыть форму с выбором оплаты и адресом
- `basket:open` - Открыть корзину
- `basket:added` - Добавить один лот в корзину
- `preview:changed` - Открыть карточку
- `modal:open` - Блокируем прокрутку страницы если открыта модалка
- `modal:close` - Разблокирует прокрутку страницы если закрыта модалка